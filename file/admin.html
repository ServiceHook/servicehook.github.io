<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel | Jachu</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="stylea.css" />
  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
</head>
<body>

  <div id="loginSection">
    <div class="login-card">
      <h2>ğŸ” Admin Access</h2>
      <input type="text" id="username" placeholder="Admin Email" class="input" />
      <input type="password" id="password" placeholder="Password" class="input" />
      <button onclick="login()" class="button" style="width: 100%;">Login to Dashboard</button>
      <p id="loginError" style="color: #ef4444; margin-top: 15px; font-size: 0.9rem;"></p>
    </div>
  </div>

  <div id="adminContent" style="display: none;">
    
    <div class="sidebar">
      <h1>âš¡ Jachu Admin</h1>
      <ul>
        <li onclick="switchSection('dashboard')" id="nav-dashboard" class="active">ğŸ“Š Dashboard</li>
        <li onclick="switchSection('manage')" id="nav-manage">ğŸ”— Manage Links</li>
        <li onclick="switchSection('users')" id="nav-users">ğŸ‘¥ API Users</li>
        <li onclick="switchSection('billing')" id="nav-billing">ğŸ’° Billing <span id="billBadge" style="background:red; color:white; font-size:0.7rem; padding:2px 5px; border-radius:10px; display:none;">!</span></li>
        <li onclick="switchSection('donations')" id="nav-donations">ğŸ’œ Donations</li>
        <li onclick="switchSection('ban')" id="nav-ban">ğŸš« Banned Users</li>
        <li onclick="logout()" style="margin-top: auto; color: #ef4444;">ğŸšª Logout</li>
      </ul>
    </div>

    <div class="main">
      
      <div id="dashboard" class="section">
        <h2 style="margin-bottom: 20px;">Overview</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Links</h3>
            <p id="totalCount">0</p>
          </div>
          <div class="stat-card">
            <h3>Created Today</h3>
            <p id="todayCount" style="color: #4ade80;">0</p>
          </div>
          <div class="stat-card">
            <h3>Total Donations</h3>
            <p id="donationCount" style="color: #f472b6;">0</p>
          </div>
          <div class="stat-card">
            <h3>Donation Amount</h3>
            <p id="donationTotalAmount" style="color: #22d3ee;">â‚¹0</p>
          </div>
        </div>
        <div class="stat-card" style="margin-bottom: 30px; border: 1px solid var(--border-color); padding: 20px;">
          <h3 style="margin-bottom: 15px;">ğŸ“ˆ Growth (Last 7 Days)</h3>
          <div style="position: relative; height: 300px; width: 100%;">
            <canvas id="growthChart"></canvas>
          </div>
        </div>
        <h3>ğŸ•“ Recently Created</h3>
        <ul id="lastLinks" style="list-style: none; padding: 0;"></ul>
      </div>

      <div id="manage" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>All Links</h2>
          <div style="display: flex; gap: 10px;">
             <input type="text" id="searchInput" oninput="searchLinks()" placeholder="Search alias or URL..." class="input" style="width: 250px; margin-bottom: 0;" />
             <button onclick="loadLinks()" class="button">Refresh</button>
          </div>
        </div>
        <table id="urlTable">
          <thead>
            <tr>
              <th width="150">Alias</th>
              <th>Target URL</th>
              <th width="80">Clicks</th>
              <th width="120">Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="pagination">
          <button onclick="showPrevBatch()" class="button btn-sm">â¬… Prev</button>
          <span id="pageInfo" style="color: var(--text-muted); font-size: 0.9rem;">Page 1</span>
          <button onclick="showNextBatch()" class="button btn-sm">Next â¡</button>
        </div>
      </div>

      <div id="users" class="section hidden">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2>API User Database</h2>
          <button onclick="loadApiUsers()" class="button">ğŸ”„ Refresh List</button>
        </div>
        <p style="color: var(--text-muted); margin-bottom: 15px;">
           Manage usage limits. <span style="color:#4ade80;">Green rows</span> indicate paid/upgraded users.
        </p>
        <div class="table-container">
            <table id="apiUserTable">
              <thead>
                <tr>
                  <th>User Identity (UID & Email)</th>
                  <th>Usage / Limit</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody><tr><td colspan="4">Loading users...</td></tr></tbody>
            </table>
        </div>
      </div>

      <div id="billing" class="section hidden">
        <h2>ğŸ’° Payment Requests</h2>
        <p style="color: var(--text-muted);">Approve Plan Upgrades here.</p>
        <table id="billingTable">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Plan</th>
                    <th>Txn ID</th>
                    <th>Amount</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
      </div>


      <div id="donations" class="section hidden">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:12px;">
          <h2>ğŸ’œ Donation Records</h2>
          <div style="display:flex; gap:10px;">
            <button onclick="loadDonations()" class="button">ğŸ”„ Refresh</button>
            <button onclick="exportDonationsCSV()" class="button" style="background:#0ea5e9;">â¬‡ Export CSV</button>
          </div>
        </div>
        <p style="color: var(--text-muted);">Shows successful donations from the Donate page (including note, purpose, and payment ID).</p>
        <div class="table-container">
          <table id="donationsTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>Donor</th>
                <th>Purpose</th>
                <th>Amount</th>
                <th>Payment ID</th>
                <th>Note</th>
              </tr>
            </thead>
            <tbody><tr><td colspan="6">No donation data loaded.</td></tr></tbody>
          </table>
        </div>
      </div>

      <div id="ban" class="section hidden">
        <h2>ğŸš« Restricted Users</h2>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div class="shortener-box" style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px;">
             <h3>ğŸ“§ Banned Emails</h3>
             <ul id="bannedList" style="list-style: none; padding: 0; margin-top: 15px;"></ul>
          </div>
          <div class="shortener-box" style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 12px;">
             <h3>ğŸ’» Banned IPs</h3>
             <div style="display: flex; gap: 10px; margin-bottom: 15px;">
               <input type="text" id="ipInput" placeholder="IP Address" class="input" style="margin:0; padding: 8px;">
               <button onclick="manualBanIp()" class="button" style="width: auto;">Ban</button>
             </div>
             <ul id="bannedIpList" style="list-style: none; padding: 0;"></ul>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="scripta.js"></script>
</body>
</html>